<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="[TOC] Spring注解总结启动注解@SpringBootApplication@SpringBootApplication 用于标注程序主启动类。 123456@SpringBootApplicationpublic class SpringBootApplication &amp;#123;    public static void main(java.lang.String[] args) &amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="ShiftJava&#x2F;H Spring&#x2F;M Spring注解总结">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2021&#x2F;08&#x2F;07&#x2F;ShiftJava&#x2F;H%20Spring&#x2F;M%20Spring%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93&#x2F;index.html">
<meta property="og:site_name" content="路漫漫其修远兮">
<meta property="og:description" content="[TOC] Spring注解总结启动注解@SpringBootApplication@SpringBootApplication 用于标注程序主启动类。 123456@SpringBootApplicationpublic class SpringBootApplication &amp;#123;    public static void main(java.lang.String[] args) &amp;">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2021&#x2F;08&#x2F;07&#x2F;ShiftJava&#x2F;H%20Spring&#x2F;M%20Spring%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93&#x2F;assets&#x2F;c7bacd12-1c1a-4e41-aaaf-4cad840fc073.png">
<meta property="og:updated_time" content="2021-01-06T11:22:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2021&#x2F;08&#x2F;07&#x2F;ShiftJava&#x2F;H%20Spring&#x2F;M%20Spring%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93&#x2F;assets&#x2F;c7bacd12-1c1a-4e41-aaaf-4cad840fc073.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"right","wideth":200,"display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":1},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/08/07/ShiftJava/H Spring/M Spring注解总结/"/>





  <title>ShiftJava/H Spring/M Spring注解总结 | 路漫漫其修远兮</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">路漫漫其修远兮</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/08/07/ShiftJava/H%20Spring/M%20Spring%E6%B3%A8%E8%A7%A3%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="路漫漫其修远兮">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ShiftJava/H Spring/M Spring注解总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-08-07T19:04:17+08:00">
                2021-08-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>[TOC]</p>
<h3 id="Spring注解总结"><a href="#Spring注解总结" class="headerlink" title="Spring注解总结"></a>Spring注解总结</h3><h4 id="启动注解-SpringBootApplication"><a href="#启动注解-SpringBootApplication" class="headerlink" title="启动注解@SpringBootApplication"></a>启动注解@SpringBootApplication</h4><p>@SpringBootApplication 用于标注程序主启动类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringSecurityJwtGuideApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@SpringBootApplication</strong> 源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(excludeFilters = &#123;</span><br><span class="line">		<span class="meta">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter<span class="class">.<span class="keyword">class</span>),</span></span><br><span class="line"><span class="class">		@<span class="title">Filter</span>(<span class="title">type</span> </span>= FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter<span class="class">.<span class="keyword">class</span>) &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> @<span class="title">interface</span> <span class="title">SpringBootApplication</span> </span>&#123;</span><br><span class="line">   <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@SpringBootConfiguration</strong> 源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.boot;</span><br><span class="line"><span class="meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>@EnableAutoConfiguration</strong>：启用 SpringBoot 的<strong>自动配置机制</strong>。</li>
<li><strong>@ComponentScan</strong>： 扫描被 @Component (@Service,@Controller)注解的 bean，<strong>注解默认会扫描该类所在的包下所有的类</strong>。</li>
<li><strong>@Configuration</strong>：允许在 Spring 上下文中注册额外的 bean 或导入其他配置类。</li>
</ul>
<h4 id="Bean相关注解"><a href="#Bean相关注解" class="headerlink" title="Bean相关注解"></a>Bean相关注解</h4><h5 id="1-Autowired"><a href="#1-Autowired" class="headerlink" title="1. @Autowired"></a>1. @Autowired</h5><p>自动导入对象到类中，被注入进的类同样要被 Spring 容器管理比如：Service 类注入到 Controller 类中。</p>
<h5 id="2-Component-Repository-Service-Controller"><a href="#2-Component-Repository-Service-Controller" class="headerlink" title="2. @Component,@Repository,@Service, @Controller"></a>2. @Component,@Repository,@Service, @Controller</h5><p>一般使用 @Autowired 注解让 Spring 容器<strong>自动装配 bean</strong>。要想把类标识成可<strong>用于 @Autowired 注解自动装配</strong>的 bean 的类，可以采用以下注解实现：</p>
<ul>
<li><strong>@Component</strong>：<strong>通用</strong>的注解，可标注任意类为 Spring 组件。如果一个 Bean 不知道属于哪个层，可以使用@Component 注解标注。</li>
<li><strong>@Repository</strong>：对应持久层即 Dao 层，主要用于数据库相关操作。</li>
<li><strong>@Service</strong>：对应服务层，主要涉及一些复杂的逻辑，需要用到 Dao 层。</li>
<li><strong>@Controller</strong>：对应 Spring MVC 控制层，主要用户接受用户请求并调用 Service 层返回数据给前端页面。</li>
</ul>
<h5 id="3-Configuration"><a href="#3-Configuration" class="headerlink" title="3. @Configuration"></a>3. @Configuration</h5><p>一般用来声明<strong>配置类</strong>，可以使用 @Component 注解替代，不过使用 @Configuration 注解声明配置类更加语义化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransferService <span class="title">transferService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TransferServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-Scope"><a href="#4-Scope" class="headerlink" title="4. @Scope"></a>4. @Scope</h5><p>声明 Spring Bean 的<strong>作用域</strong>，使用方式如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope</span>(<span class="string">"singleton"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">personSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Person();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>四种常见的 Bean 作用域：</strong></p>
<ul>
<li><strong>singleton</strong>：唯一 bean 实例，Spring 中的 bean 默认都是<strong>单例</strong>的。</li>
<li><strong>prototype</strong>：每次请求都会创建一个新的 bean 实例。</li>
<li><strong>request</strong>：每一次 HTTP 请求都会产生一个新的 bean，该 bean 仅在当前 HTTP request 内有效。</li>
<li><strong>session</strong>：每一次 HTTP 请求都会产生一个新的 bean，该 bean 仅在当前 HTTP session 内有效。</li>
</ul>
<h4 id="HTTP请求相关注解"><a href="#HTTP请求相关注解" class="headerlink" title="HTTP请求相关注解"></a>HTTP请求相关注解</h4><h5 id="1-GET请求"><a href="#1-GET请求" class="headerlink" title="1. GET请求"></a>1. GET请求</h5><p><strong>@GetMapping</strong>(“users”) 等价于@RequestMapping(value=”/users”, method = RequestMethod.GET)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;User&gt;&gt; getAllUsers() &#123;</span><br><span class="line">    <span class="keyword">return</span> userRepository.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-POST请求"><a href="#2-POST请求" class="headerlink" title="2. POST请求"></a>2. POST请求</h5><p><strong>@PostMapping</strong>(“users”) 等价于@RequestMapping(value=”/users”, method = RequestMethod.POST)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">createUser</span><span class="params">(@Valid @RequestBody UserCreateRequest userCreateRequest)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userRespository.save(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-PUT请求"><a href="#3-PUT请求" class="headerlink" title="3. PUT请求"></a>3. PUT请求</h5><p><strong>@PutMapping</strong>(“/users/{userId}”) 等价于 @RequestMapping(value=”/users/{userId}”, method = RequestMethod.PUT)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span>(<span class="string">"/users/&#123;userId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title">updateUser</span><span class="params">(@PathVariable(value = <span class="string">"userId"</span>)</span> Long userId,</span></span><br><span class="line"><span class="function">                                       @Valid @RequestBody UserUpdateRequest userUpdateRequest) </span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-DELETE请求"><a href="#4-DELETE请求" class="headerlink" title="4. DELETE请求"></a>4. DELETE请求</h5><p><strong>@DeleteMapping</strong>(“/users/{userId}”)等价于 @RequestMapping(value=”/users/{userId}”, method = RequestMethod.DELETE)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span>(<span class="string">"/users/&#123;userId&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">deleteUser</span><span class="params">(@PathVariable(value = <span class="string">"userId"</span>)</span> Long userId)</span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-PATCH请求"><a href="#5-PATCH请求" class="headerlink" title="5. PATCH请求"></a>5. PATCH请求</h5><p>用得少，一般都是 PUT 不够用了之后才用 PATCH 请求去更新数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PatchMapping</span>(<span class="string">"/profile"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">updateStudent</span><span class="params">(@RequestBody StudentUpdateRequest studentUpdateRequest)</span> </span>&#123;</span><br><span class="line">    studentRepository.updateDetail(studentUpdateRequest);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="参数传递相关注解"><a href="#参数传递相关注解" class="headerlink" title="参数传递相关注解"></a>参数传递相关注解</h4><h5 id="1-PathVariable和-RequestParam"><a href="#1-PathVariable和-RequestParam" class="headerlink" title="1. @PathVariable和@RequestParam"></a>1. @PathVariable和@RequestParam</h5><p><strong>@PathVariable 用于获取路径参数，@RequestParam 用于获取查询参数。</strong></p>
<p>举个简单的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/user/&#123;userId&#125;/teachers"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Teacher&gt; <span class="title">getKlassRelatedTeachers</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    @PathVariable(<span class="string">"klassId"</span>)</span> Long klassId,</span></span><br><span class="line"><span class="function">    @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"type"</span>, required = <span class="keyword">false</span>)</span> String type) </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果请求的 url 是：/user/{123456}/teachers?type=web，那么服务获取到的数据就是：userId=123456, type=web。</p>
<h5 id="2-RequestBody"><a href="#2-RequestBody" class="headerlink" title="2. @RequestBody"></a>2. @RequestBody</h5><p>用于<strong>读取 Request 请求</strong>（可能是 POST, PUT, DELETE, GET 请求）的 <strong>body 部分</strong>并且 <strong>Content-Type</strong> 为 <strong>application/json 格式</strong>的数据，接收到数据之后会自动将数据<strong>绑定到 Java 对象</strong>上去。系统会使用<strong>HttpMessageConverter</strong> 或者自定义的 HttpMessageConverter 将请求的 body 中的 json 字符串<strong>转换为 Java 对象</strong>。</p>
<p>有一个注册的接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/registry"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">registry</span><span class="params">(@RequestBody @Valid User user)</span> </span>&#123;</span><br><span class="line">    userService.save(user);</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserRegisterRequest对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@FullName</span></span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发送 post 请求到这个接口，并且 body 携带 JSON 数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"userName"</span>:<span class="string">"coder"</span>,<span class="attr">"fullName"</span>:<span class="string">"shuangkou"</span>,<span class="attr">"password"</span>:<span class="string">"123456"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>后端就可以直接把 json 格式的数据解析并<strong>映射</strong>到 User 类上。</p>
<p>注意：一个请求方法只可以有一个 @RequestBody，但是可以有<strong>多个</strong> @RequestParam 和 @PathVariable。 </p>
<h4 id="配置信息读取注解"><a href="#配置信息读取注解" class="headerlink" title="配置信息读取注解"></a>配置信息读取注解</h4><p>加入一个配置文件如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Jack</span></span><br><span class="line"></span><br><span class="line"><span class="attr">my-profile:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">Lucy</span></span><br><span class="line">  <span class="attr">email:</span> <span class="number">11234</span><span class="string">@163.com</span></span><br><span class="line"></span><br><span class="line"><span class="attr">library:</span></span><br><span class="line">  <span class="attr">location:</span> <span class="string">火星</span></span><br><span class="line">  <span class="attr">books:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">计算机网络</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">test</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">操作系统</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">test</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">编译原理</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<h5 id="1-value"><a href="#1-value" class="headerlink" title="1. @value"></a>1. @value</h5><p><strong>常用</strong>，使用 <strong>@Value(“${property}”)</strong> 读取比较简单的配置信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;name&#125;"</span>)</span><br><span class="line">String name;</span><br></pre></td></tr></table></figure>

<h5 id="2-ConfigurationProperties"><a href="#2-ConfigurationProperties" class="headerlink" title="2. @ConfigurationProperties"></a>2. @ConfigurationProperties</h5><p>常用，通过 <strong>@ConfigurationProperties</strong> 读取配置信息<strong>并与 bean 绑定</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">// 这里的前缀与配置文件中的前缀对应</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"library"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LibraryProperties</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; books;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@ToString</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">        String name;</span><br><span class="line">        String description;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以像使用普通的 Spring bean 一样，将其注入到类中使用。</p>
<h5 id="3-PropertySource"><a href="#3-PropertySource" class="headerlink" title="3. PropertySource"></a>3. PropertySource</h5><p>用得少，@PropertySource 读取<strong>指定 properties 文件</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:website.properties"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebSite</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="comment">//getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="参数校验"><a href="#参数校验" class="headerlink" title="参数校验"></a>参数校验</h4><h5 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h5><p><strong>JSR(Java Specification Requests）</strong> 是一套 JavaBean 参数校验的标准，它定义了很多常用的<strong>校验注解</strong>，可以直接将这些注解加在 JavaBean 的属<strong>性上面</strong>，就可以在需要校验的时候进行校验。</p>
<p>校验的时候实际用的是 <strong>Hibernate Validator</strong> 框架。目前最新版的 Hibernate Validator 6.x 是 Bean Validation 2.0（JSR 380）的<strong>参考实现</strong>。SpringBoot 项目的 spring-boot-<strong>starter-web 依赖</strong>中已经有 <strong>hibernate-validator</strong> 包，不需要引用相关依赖。</p>
<img src="assets/c7bacd12-1c1a-4e41-aaaf-4cad840fc073.png" style="zoom:50%;" />

<p>注意： 所有的参数校验相关的注解都<strong>推荐使用 JSR 注解</strong>，即 <strong>javax.validation.constraints</strong>，而不是org.hibernate.validator.constraints 的注解。</p>
<h5 id="2-常用校验注解"><a href="#2-常用校验注解" class="headerlink" title="2. 常用校验注解"></a>2. 常用校验注解</h5><table>
<thead>
<tr>
<th align="center">注解</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>@NotEmpty</strong></td>
<td align="center">被注释的字符串的不能为 null 也不能为空</td>
</tr>
<tr>
<td align="center"><strong>@NotBlank</strong></td>
<td align="center">被注释的字符串非 null，并且必须包含一个非空白字符</td>
</tr>
<tr>
<td align="center"><strong>@Null</strong></td>
<td align="center">被注释的元素必须为 null</td>
</tr>
<tr>
<td align="center"><strong>@NotNull</strong></td>
<td align="center">被注释的元素必须不为 null</td>
</tr>
<tr>
<td align="center"><strong>@AssertTrue</strong></td>
<td align="center">被注释的元素必须为 true</td>
</tr>
<tr>
<td align="center"><strong>@AssertFalse</strong></td>
<td align="center">@AssertFalse 被注释的元素必须为 false</td>
</tr>
<tr>
<td align="center"><strong>@Pattern(regex=,flag=)</strong></td>
<td align="center">被注释的元素必须符合指定的正则表达式</td>
</tr>
<tr>
<td align="center"><strong>@Email</strong></td>
<td align="center">被注释的元素必须是 Email 格式</td>
</tr>
<tr>
<td align="center"><strong>@Min(value)</strong></td>
<td align="center">被注释的元素必须是一个数字，其值必须大于等于指定的最小值</td>
</tr>
<tr>
<td align="center"><strong>@Max(value)</strong></td>
<td align="center">被注释的元素必须是一个数字，其值必须小于等于指定的最大值</td>
</tr>
<tr>
<td align="center"><strong>@DecimalMin(value)</strong></td>
<td align="center">被注释的元素必须是一个数字，其值必须大于等于指定的最小值</td>
</tr>
<tr>
<td align="center"><strong>@DecimalMax(value)</strong></td>
<td align="center">被注释的元素必须是一个数字，其值必须小于等于指定的最大值</td>
</tr>
<tr>
<td align="center"><strong>@Size(max=, min=)</strong></td>
<td align="center">被注释的元素的大小必须在指定的范围内</td>
</tr>
<tr>
<td align="center"><strong>@Digits (integer, fraction)</strong></td>
<td align="center">被注释的元素必须是一个数字，其值必须在可接受的范围内</td>
</tr>
<tr>
<td align="center"><strong>@Past</strong></td>
<td align="center">被注释的元素必须是一个过去的日期</td>
</tr>
<tr>
<td align="center"><strong>@Future</strong></td>
<td align="center">被注释的元素必须是一个将来的日期</td>
</tr>
</tbody></table>
<h5 id="3-验证请求体-RequestBody"><a href="#3-验证请求体-RequestBody" class="headerlink" title="3. 验证请求体(RequestBody)"></a>3. 验证请求体(RequestBody)</h5><p>使用上述的注解对前端传入的参数进行校验，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"classId不能为空"</span>)</span><br><span class="line">    <span class="keyword">private</span> String classId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Size</span>(max = <span class="number">33</span>)</span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"name不能为空"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pattern</span>(regexp = <span class="string">"((^Man$|^Woman$|^UGM$))"</span>, message = <span class="string">"sex值不在可选范围"</span>)</span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"sex不能为空"</span>)</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Email</span>(message = <span class="string">"email格式不正确"</span>)</span><br><span class="line">    <span class="meta">@NotNull</span>(message = <span class="string">"email不能为空"</span>)</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在需要验证的<strong>参数</strong>上加上了 <strong>@Valid</strong> 注解，如果验证失败，它将抛出<strong>MethodArgumentNotValidException</strong> 异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/person"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;Person&gt; <span class="title">getPerson</span><span class="params">(@RequestBody @Valid Person person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().body(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-验证请求参数-Path-Variables-和-Request-Parameters"><a href="#4-验证请求参数-Path-Variables-和-Request-Parameters" class="headerlink" title="4. 验证请求参数(Path Variables 和 Request Parameters)"></a>4. 验证请求参数(Path Variables 和 Request Parameters)</h5><p>一定不要忘记在<strong>类上</strong>加上 <strong>@Validated</strong> 注解了，这个参数可以告诉 Spring 去校验方法参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api"</span>)</span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/person/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;Integer&gt; <span class="title">getPersonByID</span><span class="params">(@Valid @PathVariable(<span class="string">"id"</span>)</span> @<span class="title">Max</span><span class="params">(value = <span class="number">5</span>,message = <span class="string">"超过 id 的范围了"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().body(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="异常处理注解"><a href="#异常处理注解" class="headerlink" title="异常处理注解"></a>异常处理注解</h4><p>全局处理 Controller 层异常是非常常见的需求。</p>
<p><strong>相关注解：</strong></p>
<ol>
<li><strong>@ControllerAdvice</strong>：注解定义<strong>全局异常处理类</strong>。</li>
<li><strong>@ExceptionHandler</strong>：注解声明<strong>异常处理方法</strong>。</li>
</ol>
<p>参数校验中可能抛出的 MethodArgumentNotValidException 异常，对这个异常进行处理。也就是声明一个全局异常处理类。然后指定需要处理的异常类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求参数异常处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(MethodArgumentNotValidException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ResponseEntity</span>&lt;?&gt; <span class="title">handleMethodArgumentNotValidException</span>(<span class="title">MethodArgumentNotValidException</span> <span class="title">ex</span>, <span class="title">HttpServletRequest</span> <span class="title">request</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//......</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更多关于 Spring Boot 异常处理的内容可参考：</p>
<ol>
<li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485568&idx=2&sn=c5ba880fd0c5d82e39531fa42cb036ac&chksm=cea2474bf9d5ce5dcbc6a5f6580198fdce4bc92ef577579183a729cb5d1430e4994720d59b34&token=2133161636&lang=zh_CN#rd" target="_blank" rel="noopener">SpringBoot 处理异常的几种常见姿势</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247486379&idx=2&sn=48c29ae65b3ed874749f0803f0e4d90e&chksm=cea24460f9d5cd769ed53ad7e17c97a7963a89f5350e370be633db0ae8d783c3a3dbd58c70f8&token=1054498516&lang=zh_CN#rd" target="_blank" rel="noopener">使用枚举简单封装一个优雅的 Spring Boot 全局异常处理！</a></li>
</ol>
<h4 id="JPA相关注解"><a href="#JPA相关注解" class="headerlink" title="JPA相关注解"></a>JPA相关注解</h4><h5 id="1-创建表"><a href="#1-创建表" class="headerlink" title="1. 创建表"></a>1. 创建表</h5><p><strong>@Entity</strong> 声明一个类对应一个数据库实体。</p>
<p><strong>@Table</strong> 设置表名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"role"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-主键及主键生成策略"><a href="#2-主键及主键生成策略" class="headerlink" title="2. 主键及主键生成策略"></a>2. 主键及主键生成策略</h5><p><strong>@Id</strong> ：声明一个字段为<strong>主键</strong>。</p>
<p>使用 @Id 声明之后还需要定义<strong>主键的生成策略</strong>。可以使用 <strong>@GeneratedValue</strong> 指定主键生成策略。</p>
<p><strong>(1) 通过 @GeneratedValue 直接使用 JPA 内置提供的四种主键生成策略来指定主键生成策略。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure>

<p>JPA 使用枚举定义了 4 中常见的主键生成策略，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> GenerationType &#123;</span><br><span class="line">    <span class="comment">// 使用一个特定的数据库表格来保存主键，持久化引擎通过关系数据库的一张特定的表格来生成主键</span></span><br><span class="line">    TABLE,</span><br><span class="line">    <span class="comment">// 在某些数据库中,不支持主键自增长,比如Oracle、PostgreSQL其提供了一种叫做"序列(sequence)"的机制生成主键</span></span><br><span class="line">    SEQUENCE,</span><br><span class="line">    <span class="comment">// 主键自增长，常用</span></span><br><span class="line">    IDENTITY,</span><br><span class="line">    <span class="comment">// 把主键生成策略交给持久化引擎(persistence engine),持久化引擎会根据数据库在以上三种主键生成 策略中选择其中一种</span></span><br><span class="line">    AUTO</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@GeneratedValue 注解<strong>默认</strong>使用的策略是 GenerationType.<strong>AUTO</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> GeneratedValue &#123;</span><br><span class="line">    <span class="function">GenerationType <span class="title">strategy</span><span class="params">()</span> <span class="keyword">default</span> AUTO</span>;</span><br><span class="line">    <span class="function">String <span class="title">generator</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一般使用 <strong>MySQL</strong> 数据库的话，使用 GenerationType.<strong>IDENTITY</strong> 策略比较普遍一点（分布式系统的话需要另外考虑<strong>使用分布式 ID</strong>）。</p>
<p><strong>(2) 通过 @GenericGenerator 声明一个主键策略，然后 @GeneratedValue 使用这个策略</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(generator = <span class="string">"IdentityIdGenerator"</span>)</span><br><span class="line"><span class="meta">@GenericGenerator</span>(name = <span class="string">"IdentityIdGenerator"</span>, strategy = <span class="string">"identity"</span>)</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure>

<p>JPA 提供的<strong>主键生成策略</strong>有如下几种：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultIdentifierGeneratorFactory</span> <span class="keyword">implements</span> </span></span><br><span class="line"><span class="class">    <span class="title">MutableIdentifierGeneratorFactory</span>, <span class="title">Serializable</span>, <span class="title">ServiceRegistryAwareService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"deprecation"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DefaultIdentifierGeneratorFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        register( <span class="string">"uuid2"</span>, UUIDGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        <span class="comment">// can be done with UUIDGenerator + strategy</span></span><br><span class="line">        register( <span class="string">"guid"</span>, GUIDGenerator<span class="class">.<span class="keyword">class</span> )</span>;	</span><br><span class="line">        <span class="comment">// "deprecated" for new use</span></span><br><span class="line">        register( <span class="string">"uuid"</span>, UUIDHexGenerator<span class="class">.<span class="keyword">class</span> )</span>;	</span><br><span class="line">        <span class="comment">// uuid.hex is deprecated</span></span><br><span class="line">        register( <span class="string">"uuid.hex"</span>, UUIDHexGenerator<span class="class">.<span class="keyword">class</span> )</span>; 	</span><br><span class="line">        register( <span class="string">"assigned"</span>, Assigned<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"identity"</span>, IdentityGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"select"</span>, SelectGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"sequence"</span>, SequenceStyleGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"seqhilo"</span>, SequenceHiLoGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"increment"</span>, IncrementGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"foreign"</span>, ForeignGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"sequence-identity"</span>, SequenceIdentityGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"enhanced-sequence"</span>, SequenceStyleGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">        register( <span class="string">"enhanced-table"</span>, TableGenerator<span class="class">.<span class="keyword">class</span> )</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(String strategy, Class generatorClass)</span> </span>&#123;</span><br><span class="line">        LOG.debugf( <span class="string">"Registering IdentifierGenerator strategy [%s] -&gt; [%s]"</span>, strategy, generatorClass.getName() );</span><br><span class="line">        <span class="keyword">final</span> Class previous = generatorStrategyToClassNameMap.put( strategy, generatorClass );</span><br><span class="line">        <span class="keyword">if</span> ( previous != <span class="keyword">null</span> ) &#123;</span><br><span class="line">            LOG.debugf( <span class="string">"    - overriding [%s]"</span>, previous.getName() );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-设置字段及属性"><a href="#3-设置字段及属性" class="headerlink" title="3. 设置字段及属性"></a>3. 设置字段及属性</h5><p><strong>@Column</strong> 声明字段及其<strong>属性</strong>。</p>
<p><strong>示例：</strong>设置属性 userName 对应的数据库字段名为 user_name，长度为 32，非空。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Column</span>(name = <span class="string">"user_name"</span>, nullable = <span class="keyword">false</span>, length = <span class="number">32</span>)</span><br><span class="line"><span class="keyword">private</span> String userName;</span><br></pre></td></tr></table></figure>

<p>设置字段类型并且加<strong>默认值</strong>，挺常用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Column(columnDefinition = <span class="string">"tinyint(1) default 1"</span>)</span><br><span class="line"><span class="keyword">private</span> Boolean enabled;</span><br></pre></td></tr></table></figure>

<h5 id="4-指定不持久化特定字段"><a href="#4-指定不持久化特定字段" class="headerlink" title="4. 指定不持久化特定字段"></a>4. 指定不持久化特定字段</h5><p><strong>@Transient</strong>：声明不需要与数据库映射的字段，在保存的时候<strong>不需要持久化</strong>保存进数据库 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(name=<span class="string">"USER"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 不会被持久化</span></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String email; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了 @Transient 关键字声明， 还可以采用下面几种方法不持久化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> String secrect; <span class="comment">// not persistent because of static</span></span><br><span class="line"><span class="keyword">final</span> String secrect = “Satish”; <span class="comment">// not persistent because of final</span></span><br><span class="line"><span class="keyword">transient</span> String secrect; <span class="comment">// not persistent because of transient</span></span><br></pre></td></tr></table></figure>

<p>一般使用<strong>注解</strong>的方式比较多。</p>
<h5 id="5-声明大字段"><a href="#5-声明大字段" class="headerlink" title="5. 声明大字段"></a>5. 声明大字段</h5><p><strong>@Lob</strong>：声明某个字段为<strong>大字段</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Lob</span></span><br><span class="line"><span class="keyword">private</span> String content;</span><br></pre></td></tr></table></figure>

<p>更详细的使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Lob</span></span><br><span class="line"><span class="comment">//指定Lob类型数据的获取策略，FetchType.EAGER表示非延迟加载，而FetchType.LAZY表示延迟加载 </span></span><br><span class="line"><span class="meta">@Basic</span>(fetch = FetchType.EAGER)</span><br><span class="line"><span class="comment">// columnDefinition 属性指定数据表对应的Lob字段类型</span></span><br><span class="line"><span class="meta">@Column</span>(name = <span class="string">"content"</span>, columnDefinition = <span class="string">"LONGTEXT NOT NULL"</span>)</span><br><span class="line"><span class="keyword">private</span> String content;</span><br></pre></td></tr></table></figure>

<h5 id="6-创建枚举类型的字段"><a href="#6-创建枚举类型的字段" class="headerlink" title="6. 创建枚举类型的字段"></a>6. 创建枚举类型的字段</h5><p>可以使用<strong>枚举类型</strong>的字段，不过枚举字段要用 <strong>@Enumerated</strong> 注解修饰。创建一个<strong>枚举类</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Gender &#123;</span><br><span class="line">    MALE(<span class="string">"男性"</span>),</span><br><span class="line">    FEMALE(<span class="string">"女性"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    Gender(String str)&#123;</span><br><span class="line">        value = str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在表中使用枚举类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"role"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">// 指定枚举类型</span></span><br><span class="line">    <span class="meta">@Enumerated</span>(EnumType.STRING)</span><br><span class="line">    <span class="keyword">private</span> Gender gender;</span><br><span class="line">    <span class="comment">//省略getter/setter......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据库里面对应存储的是 <strong>MAIL/FEMAIL</strong>。</p>
<h5 id="7-增加审计功能"><a href="#7-增加审计功能" class="headerlink" title="7. 增加审计功能"></a>7. 增加审计功能</h5><p>只要继承了 <strong>AbstractAuditBase</strong> 的类都会<strong>默认加上下面四个字段</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@MappedSuperclass</span></span><br><span class="line"><span class="meta">@EntityListeners</span>(value = AuditingEntityListener<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">abstract</span> <span class="title">class</span> <span class="title">AbstractAuditBase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CreatedDate</span></span><br><span class="line">    <span class="meta">@Column</span>(updatable = <span class="keyword">false</span>)</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Instant createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@LastModifiedDate</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Instant updatedAt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CreatedBy</span></span><br><span class="line">    <span class="meta">@Column</span>(updatable = <span class="keyword">false</span>)</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String createdBy;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@LastModifiedBy</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String updatedBy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的<strong>审计功能</strong>的配置类可以是下面这样的（Spring Security 项目）:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaAuditing</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuditSecurityConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">AuditorAware&lt;String&gt; <span class="title">auditorAware</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> () -&gt; Optional.ofNullable(SecurityContextHolder.getContext())</span><br><span class="line">            .map(SecurityContext::getAuthentication)</span><br><span class="line">            .filter(Authentication::isAuthenticated)</span><br><span class="line">            .map(Authentication::getName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@CreatedDate</strong>：表示该字段为<strong>创建时间</strong>字段，在这个实体被 insert 的时候，会设置这个值。</p>
<p><strong>@CreatedBy</strong>：表示该字段为<strong>创建人</strong>，在这个实体被 insert 的时候，会设置这个值。<strong>@LastModifiedDate、@LastModifiedBy</strong>同理。</p>
<p><strong>@EnableJpaAuditing</strong>：<strong>开启 JPA 审计</strong>功能。</p>
<h5 id="8-删除-修改数据"><a href="#8-删除-修改数据" class="headerlink" title="8. 删除/修改数据"></a>8. 删除/修改数据</h5><p><strong>@Modifying</strong> 注解提示 JPA 该操作是<strong>修改操作</strong>，注意还要配合 <strong>@Transactional 注解</strong>使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Modifying</span></span><br><span class="line">    <span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">deleteByUserName</span>(<span class="title">String</span> <span class="title">userName</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="9-关联关系"><a href="#9-关联关系" class="headerlink" title="9. 关联关系"></a>9. 关联关系</h5><ul>
<li><strong>@OneToOne</strong>：声明一对一关系</li>
<li><strong>@OneToMany</strong>：声明一对多关系</li>
<li><strong>@ManyToOne</strong>：声明多对一关系</li>
<li><strong>MangToMang</strong>：声明多对多关系</li>
</ul>
<p>更多关于 Spring Boot JPA 的文章请看我的这篇文章：</p>
<h4 id="事务相关注解"><a href="#事务相关注解" class="headerlink" title="事务相关注解"></a>事务相关注解</h4><h5 id="1-Transactional"><a href="#1-Transactional" class="headerlink" title="1. @Transactional"></a>1. @Transactional</h5><p>在方法上使用 <strong>@Transactional</strong> 注解即可开启事务!</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">void</span> <span class="title">save</span>() </span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Exception 分为<strong>运行时异常</strong> RuntimeException 和<strong>非运行时异常</strong>。在 @Transactional 注解中如果不配置 rollbackFor 属性，那么事物只会在<strong>遇到 RuntimeException 的时候才会回滚</strong>，加上 rollbackFor=Exception.class，可以让事务在遇到<strong>非运行时异常时</strong>也回滚。</p>
<p>@Transactional 注解一般用在可以作用在<strong>类或者方法</strong>上。</p>
<ul>
<li><strong>作用于类</strong>：当把 @Transactional 注解放在类上时，表示所有该类的 <strong>public</strong> 方法都配置相同的事务属性信息。</li>
<li><strong>作用于方法</strong>：当类配置了 @Transactional，方法也配置了 @Transactional，<strong>方法的事务会覆盖类</strong>的事务配置信息。</li>
</ul>
<h4 id="JSON相关注解"><a href="#JSON相关注解" class="headerlink" title="JSON相关注解"></a>JSON相关注解</h4><h5 id="1-忽略JSON属性"><a href="#1-忽略JSON属性" class="headerlink" title="1. 忽略JSON属性"></a>1. 忽略JSON属性</h5><p><strong>@JsonIgnoreProperties</strong> 作用在<strong>类上</strong>用于<strong>过滤掉特定字段不返回</strong>或者不解析。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成json时将userRoles属性过滤</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties</span>(&#123;<span class="string">"userRoles"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;UserRole&gt; userRoles = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@JsonIgnore</strong> 一般用于类的<strong>属性</strong>上，作用和上面的 @JsonIgnoreProperties 一样。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String fullName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">// 生成json时将userRoles属性过滤</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;UserRole&gt; userRoles = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-格式化JSON数据"><a href="#2-格式化JSON数据" class="headerlink" title="2. 格式化JSON数据"></a>2. 格式化JSON数据</h5><p><strong>@JsonFormat</strong> 一般用来<strong>格式化</strong> json 数据。比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat</span>(shape = JsonFormat.Shape.STRING, pattern=<span class="string">"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"</span>, timezone=<span class="string">"GMT"</span>)</span><br><span class="line"><span class="keyword">private</span> Date date;</span><br></pre></td></tr></table></figure>

<h5 id="3-扁平化对象"><a href="#3-扁平化对象" class="headerlink" title="3. 扁平化对象"></a>3. 扁平化对象</h5><p>使用 <strong>@JsonUnwrapped</strong> 可以将对象进行<strong>扁平化</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonUnwrapped</span></span><br><span class="line">    <span class="keyword">private</span> Location location;</span><br><span class="line">    <span class="meta">@JsonUnwrapped</span></span><br><span class="line">    <span class="keyword">private</span> PersonInfo personInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Location</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String provinceName;</span><br><span class="line">        <span class="keyword">private</span> String countyName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonInfo</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String userName;</span><br><span class="line">        <span class="keyword">private</span> String fullName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>未扁平化</strong>之前：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"location"</span>: &#123;</span><br><span class="line">        <span class="attr">"provinceName"</span>:<span class="string">"111"</span>,</span><br><span class="line">        <span class="attr">"countyName"</span>:<span class="string">"222"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"personInfo"</span>: &#123;</span><br><span class="line">        <span class="attr">"userName"</span>: <span class="string">"333"</span>,</span><br><span class="line">        <span class="attr">"fullName"</span>: <span class="string">"444"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 @JsonUnwrapped 扁平对象之后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonUnwrapped</span></span><br><span class="line">    <span class="keyword">private</span> Location location;</span><br><span class="line">    <span class="meta">@JsonUnwrapped</span></span><br><span class="line">    <span class="keyword">private</span> PersonInfo personInfo;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"provinceName"</span>:<span class="string">"111"</span>,</span><br><span class="line">    <span class="attr">"countyName"</span>:<span class="string">"222"</span>,</span><br><span class="line">    <span class="attr">"userName"</span>: <span class="string">"333"</span>,</span><br><span class="line">    <span class="attr">"fullName"</span>: <span class="string">"444"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试相关注解"><a href="#测试相关注解" class="headerlink" title="测试相关注解"></a>测试相关注解</h4><p><strong>@ActiveProfiles</strong> 一般作用于<strong>测试类</strong>上， 用于声明生效的 Spring <strong>配置文件</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span>(webEnvironment = RANDOM_PORT)</span><br><span class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBase</span> </span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@Test</strong> 声明一个方法为<strong>测试方法</strong>。</p>
<p><strong>@Transactional</strong> 被声明的测试方法的<strong>数据会回滚</strong>，避免污染测试数据。</p>
<p><strong>@WithMockUser</strong> 是 Spring Security 提供的用来模拟一个真实用户的注解，并且可以赋予权限。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@WithMockUser</span>(username = <span class="string">"user-id-18163138155"</span>, authorities = <span class="string">"ROLE_TEACHER"</span>)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">userTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485689&idx=1&sn=061b32c2222869932be5631fb0bb5260&chksm=cea24732f9d5ce24a356fb3675170e7843addbfcc79ee267cfdb45c83fc7e90babf0f20d22e1&token=292197051&lang=zh_CN#rd" target="_blank" rel="noopener">一文搞懂如何在 Spring Boot 正确中使用 JPA</a> 。</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/08/07/ShiftJava/H%20Spring/N%20Spring%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="next" title="ShiftJava/H Spring/N Spring中的设计模式">
                <i class="fa fa-chevron-left"></i> ShiftJava/H Spring/N Spring中的设计模式
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/08/07/ShiftJava/H%20Spring/H%20Spring%20Boot%E5%BA%94%E7%94%A8%E6%95%B4%E5%90%88/" rel="prev" title="ShiftJava/H Spring/H Spring Boot应用整合">
                ShiftJava/H Spring/H Spring Boot应用整合 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Yue</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">163</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring注解总结"><span class="nav-number">1.</span> <span class="nav-text">Spring注解总结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#启动注解-SpringBootApplication"><span class="nav-number">1.1.</span> <span class="nav-text">启动注解@SpringBootApplication</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bean相关注解"><span class="nav-number">1.2.</span> <span class="nav-text">Bean相关注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-Autowired"><span class="nav-number">1.2.1.</span> <span class="nav-text">1. @Autowired</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-Component-Repository-Service-Controller"><span class="nav-number">1.2.2.</span> <span class="nav-text">2. @Component,@Repository,@Service, @Controller</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-Configuration"><span class="nav-number">1.2.3.</span> <span class="nav-text">3. @Configuration</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-Scope"><span class="nav-number">1.2.4.</span> <span class="nav-text">4. @Scope</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP请求相关注解"><span class="nav-number">1.3.</span> <span class="nav-text">HTTP请求相关注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-GET请求"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. GET请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-POST请求"><span class="nav-number">1.3.2.</span> <span class="nav-text">2. POST请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-PUT请求"><span class="nav-number">1.3.3.</span> <span class="nav-text">3. PUT请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-DELETE请求"><span class="nav-number">1.3.4.</span> <span class="nav-text">4. DELETE请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-PATCH请求"><span class="nav-number">1.3.5.</span> <span class="nav-text">5. PATCH请求</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参数传递相关注解"><span class="nav-number">1.4.</span> <span class="nav-text">参数传递相关注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-PathVariable和-RequestParam"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. @PathVariable和@RequestParam</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-RequestBody"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. @RequestBody</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置信息读取注解"><span class="nav-number">1.5.</span> <span class="nav-text">配置信息读取注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-value"><span class="nav-number">1.5.1.</span> <span class="nav-text">1. @value</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-ConfigurationProperties"><span class="nav-number">1.5.2.</span> <span class="nav-text">2. @ConfigurationProperties</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-PropertySource"><span class="nav-number">1.5.3.</span> <span class="nav-text">3. PropertySource</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参数校验"><span class="nav-number">1.6.</span> <span class="nav-text">参数校验</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-概述"><span class="nav-number">1.6.1.</span> <span class="nav-text">1. 概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-常用校验注解"><span class="nav-number">1.6.2.</span> <span class="nav-text">2. 常用校验注解</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-验证请求体-RequestBody"><span class="nav-number">1.6.3.</span> <span class="nav-text">3. 验证请求体(RequestBody)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-验证请求参数-Path-Variables-和-Request-Parameters"><span class="nav-number">1.6.4.</span> <span class="nav-text">4. 验证请求参数(Path Variables 和 Request Parameters)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#异常处理注解"><span class="nav-number">1.7.</span> <span class="nav-text">异常处理注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JPA相关注解"><span class="nav-number">1.8.</span> <span class="nav-text">JPA相关注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-创建表"><span class="nav-number">1.8.1.</span> <span class="nav-text">1. 创建表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-主键及主键生成策略"><span class="nav-number">1.8.2.</span> <span class="nav-text">2. 主键及主键生成策略</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-设置字段及属性"><span class="nav-number">1.8.3.</span> <span class="nav-text">3. 设置字段及属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-指定不持久化特定字段"><span class="nav-number">1.8.4.</span> <span class="nav-text">4. 指定不持久化特定字段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-声明大字段"><span class="nav-number">1.8.5.</span> <span class="nav-text">5. 声明大字段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-创建枚举类型的字段"><span class="nav-number">1.8.6.</span> <span class="nav-text">6. 创建枚举类型的字段</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7-增加审计功能"><span class="nav-number">1.8.7.</span> <span class="nav-text">7. 增加审计功能</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-删除-修改数据"><span class="nav-number">1.8.8.</span> <span class="nav-text">8. 删除/修改数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9-关联关系"><span class="nav-number">1.8.9.</span> <span class="nav-text">9. 关联关系</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事务相关注解"><span class="nav-number">1.9.</span> <span class="nav-text">事务相关注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-Transactional"><span class="nav-number">1.9.1.</span> <span class="nav-text">1. @Transactional</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSON相关注解"><span class="nav-number">1.10.</span> <span class="nav-text">JSON相关注解</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-忽略JSON属性"><span class="nav-number">1.10.1.</span> <span class="nav-text">1. 忽略JSON属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-格式化JSON数据"><span class="nav-number">1.10.2.</span> <span class="nav-text">2. 格式化JSON数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-扁平化对象"><span class="nav-number">1.10.3.</span> <span class="nav-text">3. 扁平化对象</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#测试相关注解"><span class="nav-number">1.11.</span> <span class="nav-text">测试相关注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参考资料"><span class="nav-number">1.12.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yue</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
