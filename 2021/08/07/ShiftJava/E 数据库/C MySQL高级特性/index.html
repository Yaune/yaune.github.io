<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="[TOC] MySQL高级特性MySQL函数调用函数： 1SELECT 函数名（实参列表）  1. 创建函数1234CREATE FUNCTION 函数名(参数名 参数类型,...) RETURNS 返回类型BEGIN	函数体END  2. MySQL函数内置各个 DBMS 的函数都是不相同的，因此不可移植。这些内置函数的使用方法详见基础部分。 (1) 聚集函数   函 数 说 明    AVG(">
<meta property="og:type" content="article">
<meta property="og:title" content="ShiftJava&#x2F;E 数据库&#x2F;C MySQL高级特性">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2021&#x2F;08&#x2F;07&#x2F;ShiftJava&#x2F;E%20%E6%95%B0%E6%8D%AE%E5%BA%93&#x2F;C%20MySQL%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7&#x2F;index.html">
<meta property="og:site_name" content="路漫漫其修远兮">
<meta property="og:description" content="[TOC] MySQL高级特性MySQL函数调用函数： 1SELECT 函数名（实参列表）  1. 创建函数1234CREATE FUNCTION 函数名(参数名 参数类型,...) RETURNS 返回类型BEGIN	函数体END  2. MySQL函数内置各个 DBMS 的函数都是不相同的，因此不可移植。这些内置函数的使用方法详见基础部分。 (1) 聚集函数   函 数 说 明    AVG(">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2021-01-06T11:22:32.000Z">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"right","wideth":200,"display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":1},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/08/07/ShiftJava/E 数据库/C MySQL高级特性/"/>





  <title>ShiftJava/E 数据库/C MySQL高级特性 | 路漫漫其修远兮</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">路漫漫其修远兮</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/08/07/ShiftJava/E%20%E6%95%B0%E6%8D%AE%E5%BA%93/C%20MySQL%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yue">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="路漫漫其修远兮">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ShiftJava/E 数据库/C MySQL高级特性</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-08-07T19:04:14+08:00">
                2021-08-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>[TOC]</p>
<h3 id="MySQL高级特性"><a href="#MySQL高级特性" class="headerlink" title="MySQL高级特性"></a>MySQL高级特性</h3><h4 id="MySQL函数"><a href="#MySQL函数" class="headerlink" title="MySQL函数"></a>MySQL函数</h4><p><strong>调用函数：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT 函数名（实参列表）</span><br></pre></td></tr></table></figure>

<h5 id="1-创建函数"><a href="#1-创建函数" class="headerlink" title="1. 创建函数"></a>1. 创建函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE FUNCTION 函数名(参数名 参数类型,...) RETURNS 返回类型</span><br><span class="line">BEGIN</span><br><span class="line">	函数体</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<h5 id="2-MySQL函数内置"><a href="#2-MySQL函数内置" class="headerlink" title="2. MySQL函数内置"></a>2. MySQL函数内置</h5><p>各个 DBMS 的函数都是不相同的，因此<strong>不可移植</strong>。这些内置函数的使用方法详见<strong>基础部分</strong>。</p>
<h6 id="1-聚集函数"><a href="#1-聚集函数" class="headerlink" title="(1) 聚集函数"></a>(1) 聚集函数</h6><table>
<thead>
<tr>
<th align="center">函 数</th>
<th align="center">说 明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>AVG()</strong></td>
<td align="center">返回<strong>某列的平均值</strong></td>
</tr>
<tr>
<td align="center"><strong>COUNT()</strong></td>
<td align="center">返回<strong>某列的行数</strong></td>
</tr>
<tr>
<td align="center"><strong>MAX()</strong></td>
<td align="center">返回<strong>某列的最大值</strong></td>
</tr>
<tr>
<td align="center"><strong>MIN()</strong></td>
<td align="center">返回<strong>某列的最小值</strong></td>
</tr>
<tr>
<td align="center"><strong>SUM()</strong></td>
<td align="center">返回<strong>某列值之和</strong></td>
</tr>
</tbody></table>
<p><strong>AVG</strong>() 会忽略 <strong>NULL</strong> 行。</p>
<p>使用 <strong>DISTINCT</strong> 可以让汇总函数值汇总不同的值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(<span class="keyword">DISTINCT</span> col1) <span class="keyword">AS</span> avg_col <span class="keyword">FROM</span> mytable;</span><br></pre></td></tr></table></figure>

<h6 id="2-文本处理函数"><a href="#2-文本处理函数" class="headerlink" title="(2) 文本处理函数"></a>(2) 文本处理函数</h6><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">LEFT()</td>
<td align="center">左边的字符</td>
<td align="center">RIGHT()</td>
<td align="center">右边的字符</td>
</tr>
<tr>
<td align="center">LOWER()</td>
<td align="center">转换为小写字符</td>
<td align="center">UPPER()</td>
<td align="center">转换为大写字符</td>
</tr>
<tr>
<td align="center">LTRIM()</td>
<td align="center">去除左边的空格</td>
<td align="center">RTRIM()</td>
<td align="center">去除右边的空格</td>
</tr>
<tr>
<td align="center">LENGTH()</td>
<td align="center">长度</td>
<td align="center">SOUNDEX()</td>
<td align="center">转换为语音值</td>
</tr>
</tbody></table>
<p>其中  <strong>SOUNDEX()</strong>  可以将一个字符串转换为描述其语音表示的字母数字模式。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> mytable <span class="keyword">WHERE</span> <span class="keyword">SOUNDEX</span>(col1) = <span class="keyword">SOUNDEX</span>(<span class="string">'apple'</span>);</span><br></pre></td></tr></table></figure>

<h6 id="3-日期和时间处理"><a href="#3-日期和时间处理" class="headerlink" title="(3) 日期和时间处理"></a>(3) 日期和时间处理</h6><ul>
<li><strong>日期格式</strong>：YYYY-MM-DD。</li>
<li><strong>时间格式</strong>：HH:MM:SS。</li>
</ul>
<table>
<thead>
<tr>
<th align="center">函 数</th>
<th align="center">说 明</th>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">AddDate()</td>
<td align="center">增加一个日期（天、周等）</td>
<td align="center">DayOfWeek()</td>
<td align="center">对于一个日期，返回对应的星期几</td>
</tr>
<tr>
<td align="center">AddTime()</td>
<td align="center">增加一个时间（时、分等）</td>
<td align="center">Hour()</td>
<td align="center">返回一个时间的小时部分</td>
</tr>
<tr>
<td align="center">CurDate()</td>
<td align="center">返回当前日期</td>
<td align="center">Minute()</td>
<td align="center">返回一个时间的分钟部分</td>
</tr>
<tr>
<td align="center">CurTime()</td>
<td align="center">返回当前时间</td>
<td align="center">Month()</td>
<td align="center">返回一个日期的月份部分</td>
</tr>
<tr>
<td align="center">Date()</td>
<td align="center">返回日期时间的日期部分</td>
<td align="center">Now()</td>
<td align="center">返回当前日期和时间</td>
</tr>
<tr>
<td align="center">DateDiff()</td>
<td align="center">计算两个日期之差</td>
<td align="center">Second()</td>
<td align="center">返回一个时间的秒部分</td>
</tr>
<tr>
<td align="center">Date_Add()</td>
<td align="center">高度灵活的日期运算函数</td>
<td align="center">Time()</td>
<td align="center">返回一个日期时间的时间部分</td>
</tr>
<tr>
<td align="center">Date_Format()</td>
<td align="center">返回一个格式化的日期或时间串</td>
<td align="center">Year()</td>
<td align="center">返回一个日期的年份部分</td>
</tr>
<tr>
<td align="center">Day()</td>
<td align="center">返回一个日期的天数部分</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT NOW();  # 2018-4-14 20:25:11</span><br></pre></td></tr></table></figure>

<h6 id="4-数值处理函数"><a href="#4-数值处理函数" class="headerlink" title="(4) 数值处理函数"></a>(4) 数值处理函数</h6><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SIN()</td>
<td align="center">正弦</td>
<td align="center">COS()</td>
<td align="center">余弦</td>
</tr>
<tr>
<td align="center">TAN()</td>
<td align="center">正切</td>
<td align="center">ABS()</td>
<td align="center">绝对值</td>
</tr>
<tr>
<td align="center">SQRT()</td>
<td align="center">平方根</td>
<td align="center">MOD()</td>
<td align="center">余数</td>
</tr>
<tr>
<td align="center">EXP()</td>
<td align="center">指数</td>
<td align="center">PI()</td>
<td align="center">圆周率</td>
</tr>
<tr>
<td align="center"><strong>RAND</strong>()</td>
<td align="center"><strong>随机数</strong></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h4 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h4><h5 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h5><p><strong>存储过程</strong>就是一组经过<strong>预先编译</strong>的 SQL 语句的集合。</p>
<p>一般来说，存储过程实现的功能要复杂一点，而函数的实现的功能针对性比较强。存储过程，功能强大，可以执行包括修改表等一系列数据库操作；用户定义函数不能用于执行一组修改全局数据库状态的操作。</p>
<p>存储过程可以看成是对一系列 SQL 操作的<strong>批处理</strong>。使用存储过程的好处：代码封装，保证了一定的安全性；代码复用；由于是预先编译，因此具有很高的性能。但是阿里巴巴的开发规范规定<strong>别用</strong>存储过程。</p>
<p>命令行中创建存储过程<strong>==需要自定义分隔符==</strong>，因为命令行是以 <strong>; 为结束符</strong>，而存储过程中也包含了<strong>分号</strong>，因此会错误把这部分分号当成是结束符，造成语法错误。</p>
<p>存储过程包含 <strong>in、out 和 inout</strong> 三种参数。</p>
<p>给变量赋值都需要用 <strong>SELECT INTO</strong> 语句，且每次只能给<strong>一个变量</strong>赋值，不支持集合的操作。</p>
<h5 id="2-创建存储过程"><a href="#2-创建存储过程" class="headerlink" title="2. 创建存储过程"></a>2. 创建存储过程</h5><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE 存储过程名(IN|OUT|INOUT 参数名 参数类型, ...)</span><br><span class="line">BEGIN</span><br><span class="line">	存储过程体</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>类似于方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修饰符 返回类型 方法名(参数类型 参数名, ...)&#123;</span><br><span class="line">	方法体;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 1.需要设置新的结束标记</span><br><span class="line">DELIMITER 新的结束标记;</span><br><span class="line">示例：</span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line">CREATE PROCEDURE 存储过程名(IN|OUT|INOUT 参数名  参数类型,...)</span><br><span class="line">BEGIN</span><br><span class="line">	sql语句1;</span><br><span class="line">	sql语句2;</span><br><span class="line">END $ </span><br><span class="line"></span><br><span class="line"># 2.存储过程体中可以有多条SQL语句，如果仅仅一条SQL语句，则可以省略BEGIN END</span><br><span class="line"></span><br><span class="line"># 3.参数前面的符号的意思</span><br><span class="line">IN: 该参数只能作为输入（该参数不能做返回值）</span><br><span class="line">OUT: 该参数只能作为输出（该参数只能做返回值）</span><br><span class="line">INOUT: 既能做输入又能做输出</span><br></pre></td></tr></table></figure>

<p>完整示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">delimiter //		# 自定义分隔符</span><br><span class="line"></span><br><span class="line">create procedure myprocedure(out ret int)</span><br><span class="line">    begin</span><br><span class="line">        declare y int;</span><br><span class="line">        select sum(col1)</span><br><span class="line">        from mytable</span><br><span class="line">        into y;</span><br><span class="line">        select y*y into ret;</span><br><span class="line">    end //</span><br><span class="line"></span><br><span class="line">delimiter ;			# 换回分隔符</span><br></pre></td></tr></table></figure>

<h5 id="3-调用存储过程"><a href="#3-调用存储过程" class="headerlink" title="3. 调用存储过程"></a>3. 调用存储过程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL 存储过程名(实参列表);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call myprocedure(@ret);</span><br><span class="line">select @ret;</span><br></pre></td></tr></table></figure>

<h5 id="4-游标"><a href="#4-游标" class="headerlink" title="4. 游标"></a>4. 游标</h5><p>在存储过程中使用<strong>游标</strong>可以对<strong>一个结果集</strong>进行<strong>移动遍历</strong>。游标主要用于<strong>交互式应用</strong>，其中用户需要对数据集中的任意行进行浏览和修改。使用游标的四个步骤：</p>
<ol>
<li><strong>声明游标</strong>，这个过程<strong>没有</strong>实际检索出数据；</li>
<li><strong>打开游标</strong>；</li>
<li><strong>取出数据</strong>；</li>
<li><strong>关闭游标</strong>；</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> myprocedure(<span class="keyword">out</span> ret <span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">declare</span> done <span class="built_in">boolean</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">declare</span> mycursor <span class="keyword">cursor</span> <span class="keyword">for</span></span><br><span class="line">        <span class="keyword">select</span> col1 <span class="keyword">from</span> mytable;</span><br><span class="line">        <span class="comment"># 定义了一个continue handler，当sqlstate '02000' 这个条件出现时，会执行set done = 1</span></span><br><span class="line">        <span class="keyword">declare</span> continue <span class="keyword">handler</span> <span class="keyword">for</span> <span class="keyword">sqlstate</span> <span class="string">'02000'</span> <span class="keyword">set</span> done = <span class="number">1</span>;</span><br><span class="line">        open mycursor;</span><br><span class="line">        repeat</span><br><span class="line">            fetch mycursor into ret;</span><br><span class="line">            <span class="keyword">select</span> ret;</span><br><span class="line">        until done <span class="keyword">end</span> <span class="keyword">repeat</span>;</span><br><span class="line">        close mycursor;</span><br><span class="line">    <span class="keyword">end</span> //</span><br><span class="line"> delimiter ;</span><br></pre></td></tr></table></figure>



<h4 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h4><h5 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1. 概述"></a>1. 概述</h5><p>视图是一张<strong>虚拟的表</strong>，它是通过表<strong>动态生成</strong>的数据。</p>
<p>视图和表的区别：两者使用方式<strong>完全相同</strong>，不过表需要占用物理空间，而视图<strong>不占用物理空间</strong>，仅仅保存的是 SQL 逻辑。</p>
<p>使用视图可以简化复杂的 SQL 操作，比如复杂的连接，且只使用实际表的一<strong>部分数据</strong>，视图可以通过只给用户<strong>访问视图的权限</strong>，保证数据的安全性。</p>
<h5 id="2-视图的基本操作"><a href="#2-视图的基本操作" class="headerlink" title="2. 视图的基本操作"></a>2. 视图的基本操作</h5><p><strong>查询语句</strong>放在 AS 后面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 创建视图</span><br><span class="line">CREATE VIEW 视图名 AS 查询语句;</span><br><span class="line"># 删除视图</span><br><span class="line">DROP VIEW test1, test2;</span><br><span class="line"># 查看视图结构</span><br><span class="line">DESC test1;</span><br><span class="line">SHOW CREATE VIEW test1;</span><br></pre></td></tr></table></figure>

<h5 id="3-视图的增删改查"><a href="#3-视图的增删改查" class="headerlink" title="3. 视图的增删改查"></a>3. 视图的增删改查</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 1.查看视图的数据 ★</span><br><span class="line">SELECT * FROM my_v4;</span><br><span class="line">SELECT * FROM my_v1 WHERE last_name = &apos;Partners&apos;;</span><br><span class="line"># 2.插入视图的数据</span><br><span class="line">INSERT INTO my_v4(last_name, department_id) VALUES(&apos;虚竹&apos;,90);</span><br><span class="line"># 3.修改视图的数据</span><br><span class="line">UPDATE my_v4 SET last_name = &apos;梦姑&apos; WHERE last_ame = &apos;虚竹&apos;;</span><br><span class="line"># 4.删除视图的数据</span><br><span class="line">DELETE FROM my_v4;</span><br></pre></td></tr></table></figure>

<h5 id="4-视图的作用"><a href="#4-视图的作用" class="headerlink" title="4. 视图的作用"></a>4. 视图的作用</h5><ul>
<li><p>测试表：user 有 id，name，age，sex 字段。</p>
</li>
<li><p>测试表：goods 有 id，name，price 字段。</p>
</li>
<li><p>测试表：ug 有 id，userid，goodsid 字段。</p>
</li>
</ul>
<p><strong>作用一：</strong> 提高了<strong>重用性</strong>，就像一个函数。如果要<strong>频繁获取</strong> user 的 name 和 goods 的 name。就可以使用以下 SQL 语言。示例：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT a.name AS username, b.name AS goodsname FROM USER AS a, goods AS b, ug AS c WHERE a.id = c.userid AND c.goodsid = b.id;</span><br></pre></td></tr></table></figure>

<p>这里利用上述的语句创建视图 <strong>other</strong>。示例：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW other AS SELECT a.name AS username, b.name AS goodsname FROM USER AS a, goods AS b, ug AS c WHERE a.id = c.userid AND c.goodsid = b.id;</span><br></pre></td></tr></table></figure>

<p>创建好视图后就可以<strong>通过视图获取</strong> user 的 name 和 goods 的 name。示例：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from other;</span><br></pre></td></tr></table></figure>

<p><strong>作用二：</strong>对数据库<strong>重构</strong>，却不影响程序的运行。有两个 user 相关的表的结构如下：</p>
<ul>
<li>测试表：usera 有 id，name，age 字段。</li>
<li>测试表：userb 有 id，name，sex 字段。</li>
</ul>
<p>现在想在结果上合并两个表到 user 中，但是物理上又不合并，这里就可以<strong>创建视图</strong>。以下 SQL 语句创建视图 user：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create view user as select a.name, a.age, b.sex from usera as a, userb as b where a.name = b.name;</span><br></pre></td></tr></table></figure>

<p>以上假设 name 都是<strong>唯一</strong>的。此时使用 SQL 语句：select * from user; 也不会报错。这就实现了<strong>更改数据库结构</strong>，不更改脚本程序的功能了。</p>
<p><strong>作用三：</strong> 提高了安全性能。可以对<strong>不同的用户，设定不同的视图</strong>。例如：某用户只能获取 user 表的 name 和 age 数据，不能获取 sex 数据。则可以这样创建视图。示例如下：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create view other as select a.name, a.age from user as a;</span><br></pre></td></tr></table></figure>

<p>这样的话，使用 SQL 语句：select * from other; 最多就只能获取 name 和 age 的数据，其他的数据就获取不了了。</p>
<p><strong>作用四：</strong> 让数据更加清晰。想要什么样的数据，就创建什么样的视图。</p>
<h5 id="5-某些视图不能更新"><a href="#5-某些视图不能更新" class="headerlink" title="5. 某些视图不能更新"></a>5. 某些视图不能更新</h5><p>如果<strong>视图中数据</strong>是来自于<strong>一个表</strong>时，<strong>修改视图中的数据</strong>，表数据会<strong>更新</strong>。而且<strong>修改表中数据</strong>时，对应视图也会<strong>更新</strong>。但是如果视图数据来源于<strong>两个表</strong>时，修改视图数据时会报错，<strong>无法</strong>修改。</p>
<h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><h5 id="1-概述-2"><a href="#1-概述-2" class="headerlink" title="1. 概述"></a>1. 概述</h5><p><strong>触发器</strong>是与表有关的数据库对象，在<strong>满足定义条件时触发</strong>，并<strong>执行触发器中定义的语句</strong>集合。触发器的这种特性可以<strong>协助</strong>应用在数据库端确保数据的完整性。</p>
<p>比如有两个表【用户表】和【日志表】，当一个用户被创建的时候，就需要在日志表中插入创建的 log 日志，如果在不使用触发器就需要<strong>编写程序语言</strong>逻辑才能实现，但如果定义一个触发器就可以实现在用户表中插入一条数据之后在日志表中插入一条日志信息。当然触发器并不是只能进行<strong>插入</strong>操作，还能执行<strong>修改，删除。</strong></p>
<h5 id="2-创建触发器"><a href="#2-创建触发器" class="headerlink" title="2. 创建触发器"></a>2. 创建触发器</h5><p>创建<strong>触发器的语法</strong>如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER trigger_name trigger_time trigger_event ON tb_name FOR EACH ROW;</span><br><span class="line"># trigger_stmt</span><br><span class="line"># trigger_name：触发器的名称</span><br><span class="line"># tirgger_time：触发时机，s为BEFORE或者AFTER</span><br><span class="line"># trigger_event：触发事件，为INSERT、DELETE或者UPDATE</span><br><span class="line"># tb_name：表示建立触发器的表明，就是在哪张表上建立触发器</span><br><span class="line"># trigger_stmt：触发器的程序体，可以是一条SQL语句或者是用BEGIN和END包含的多条语句</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 所以可以说MySQL根据触发时机创建以下六种触发器：</span><br><span class="line">BEFORE INSERT, BEFORE DELETE, BEFORE UPDATE</span><br><span class="line">AFTER INSERT, AFTER DELETE, AFTER UPDATE</span><br></pre></td></tr></table></figure>

<p>其中，触发器名参数指要创建的触发器的名字。BEFORE 和 AFTER 参数指定了触发<strong>执行的时间</strong>，在事件<strong>之前</strong>或是<strong>之后</strong>。FOR EACH ROW 表示<strong>任何一条记录</strong>上的操作满足触发事件都会触发该触发器。</p>
<p><strong>创建有多个==执行语句==的触发器</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER 触发器名 BEFORE|AFTER 触发事件</span><br><span class="line">ON 表名 FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">    执行语句列表</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>

<p>其中，<strong>BEGIN 与 END</strong> 之间的执行语句列表参数表示需要执行的<strong>多个</strong>语句，不同语句用<strong>分号</strong>隔开。</p>
<p>一般情况下，MySQL 默认是以 <strong>;</strong> 作为结束执行语句，与触发器中需要的<strong>分行</strong>起冲突，为解决此问题可用 <strong>DELIMITER</strong>，如：DELIMITER ||，可以将结束符号变成 <strong>||</strong>， 当触发器创建完成后，可以用 <strong>DELIMITER ;</strong> 来将结束符号变成 <strong>;</strong> 。这与<strong>存储过程的使用类似</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELIMITER ||		# 修改默认的结束符号</span><br><span class="line">mysql&gt; CREATE TRIGGER demo BEFORE DELETE</span><br><span class="line">    -&gt; ON users FOR EACH ROW		# 每一行都观测</span><br><span class="line">    -&gt; BEGIN</span><br><span class="line">    -&gt; INSERT INTO logs VALUES(NOW());	# BEGIN与END中间是触发时执行的逻辑</span><br><span class="line">    -&gt; INSERT INTO logs VALUES(NOW());</span><br><span class="line">    -&gt; END</span><br><span class="line">    -&gt; ||</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; DELIMITER ;	# 还原默认的结束符号</span><br></pre></td></tr></table></figure>

<p>上面的语句中，开头将结束符号定义为 ||，中间定义一个触发器，一旦有满足条件的<strong>删除操作</strong>。就会执行 BEGIN 和 END 中的语句，接着<strong>使用 || 结束</strong>。最后使用DELIMITER ; 将结束符号<strong>还原</strong>。</p>
<h5 id="3-其他"><a href="#3-其他" class="headerlink" title="3. 其他"></a>3. 其他</h5><p>触发器会在<strong>某个表</strong>执行以下语句时而<strong>自动执行</strong>：<strong>==DELETE、INSERT、UPDATE==</strong> 等操作。触发器必须指定在语句执行<strong>之前</strong>还是<strong>之后</strong>自动执行，之前执行使用 <strong>BEFORE</strong> 关键字，之后执行使用 <strong>AFTER</strong> 关键字。<strong>BEFORE 用于数据验证和净化，AFTER 用于审计跟踪</strong>，将修改记录到另外一张表中。</p>
<p>INSERT 触发器包含一个名为 <strong>NEW 的虚拟表</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> mytrigger <span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> mytable</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span> <span class="keyword">SELECT</span> NEW.col <span class="keyword">into</span> @<span class="keyword">result</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">result</span>; <span class="comment">-- 获取结果</span></span><br></pre></td></tr></table></figure>

<p><strong>DELETE</strong> 触发器包含一个名为 <strong>OLD</strong> 的虚拟表，并且是<strong>只读</strong>的。</p>
<p><strong>UPDATE</strong> 触发器包含一个名为 <strong>NEW</strong> 和一个名为 OLD 的虚拟表，其中 <strong>NEW 是可以被修改</strong>的，而 OLD 是<strong>只读的</strong>。</p>
<p>MySQL 不允许在触发器中使用 CALL 语句，也就是<strong>不能调用存储过程</strong>。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/08/07/ShiftJava/E%20%E6%95%B0%E6%8D%AE%E5%BA%93/D%20MySQL%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86/" rel="next" title="ShiftJava/E 数据库/D MySQL系统原理">
                <i class="fa fa-chevron-left"></i> ShiftJava/E 数据库/D MySQL系统原理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/08/07/ShiftJava/E%20%E6%95%B0%E6%8D%AE%E5%BA%93/Z%20MySQL%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="prev" title="ShiftJava/E 数据库/Z MySQL面试题">
                ShiftJava/E 数据库/Z MySQL面试题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Yue</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">163</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL高级特性"><span class="nav-number">1.</span> <span class="nav-text">MySQL高级特性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL函数"><span class="nav-number">1.1.</span> <span class="nav-text">MySQL函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-创建函数"><span class="nav-number">1.1.1.</span> <span class="nav-text">1. 创建函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-MySQL函数内置"><span class="nav-number">1.1.2.</span> <span class="nav-text">2. MySQL函数内置</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-聚集函数"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">(1) 聚集函数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-文本处理函数"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">(2) 文本处理函数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-日期和时间处理"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">(3) 日期和时间处理</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4-数值处理函数"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">(4) 数值处理函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#存储过程"><span class="nav-number">1.2.</span> <span class="nav-text">存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-概述"><span class="nav-number">1.2.1.</span> <span class="nav-text">1. 概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-创建存储过程"><span class="nav-number">1.2.2.</span> <span class="nav-text">2. 创建存储过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-调用存储过程"><span class="nav-number">1.2.3.</span> <span class="nav-text">3. 调用存储过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-游标"><span class="nav-number">1.2.4.</span> <span class="nav-text">4. 游标</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#视图"><span class="nav-number">1.3.</span> <span class="nav-text">视图</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-概述-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. 概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-视图的基本操作"><span class="nav-number">1.3.2.</span> <span class="nav-text">2. 视图的基本操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-视图的增删改查"><span class="nav-number">1.3.3.</span> <span class="nav-text">3. 视图的增删改查</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-视图的作用"><span class="nav-number">1.3.4.</span> <span class="nav-text">4. 视图的作用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-某些视图不能更新"><span class="nav-number">1.3.5.</span> <span class="nav-text">5. 某些视图不能更新</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#触发器"><span class="nav-number">1.4.</span> <span class="nav-text">触发器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-概述-2"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. 概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-创建触发器"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. 创建触发器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-其他"><span class="nav-number">1.4.3.</span> <span class="nav-text">3. 其他</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yue</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
